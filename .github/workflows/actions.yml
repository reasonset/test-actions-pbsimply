name: Build Site
on:
  push:
    branches: [ master ] # 自分のメインブランチ名に合わせて変更
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # 1. Rubyのセットアップ
      - name: Set up Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.4' # 使用するRubyのバージョン
          bundler-cache: true # bundle install を自動実行
      # 3. PureBuilder Simply によるビルド
      # ディレクトリ構成に合わせてビルドするディレクトリを指定
      - name: Run pbsimply build
        run: |
          bundle exec pbsimply -f .
          bundle exec pbsimply -f articles
          rsync -r images css favicon.ico ./out/
      # 4. 生成物の処理 (例: GitHub Pagesへデプロイ、またはアーティファクト保存)
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v4
        with:
          path: ./out # .pbsimply.yaml の outdir で指定したディレクトリ
  deploy:
    permissions:
      contents: read
      pages: write
      id-token: write
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4